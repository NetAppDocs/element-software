<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "file:///C:/InfoShare/Web/Author/ASP/DocTypes/dita-oasis/1.2/technicalContent/dtd/reference.dtd">
<reference id="GUID-780FAE62-622A-470E-9909-079B961BF9CA" xml:lang="en" xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/">
  <title id="GUID-B82E720D-40D4-4B08-A10C-FC1A3AE0745F">Use maintenance mode on <ph conref="ISH_variables.dita#variables/SDS-SHORT">SolidFire eSDS</ph> clusters</title>
  <shortdesc>If you need to take a storage node offline for maintenance such as software upgrades or host repairs, you can minimize the I/O impact to the rest of the storage cluster by enabling maintenance mode for that node. </shortdesc>
  <prolog>
    <metadata>
      <keywords>
        <keyword>element</keyword>
        <keyword>solidfire esds</keyword>
        <keyword>maintenance</keyword>
        <keyword>maintenance mode</keyword>
      </keywords>
    </metadata>
  </prolog>
  <refbody>
    <section id="GUID-C0A17678-4498-4AFA-A43B-97E59954F8FF">
      <note id="GUID-F52570CB-B754-4CCD-BAE4-F938FF204FEF">Ensure that you do the maintenance as soon as maintenance mode is enabled. Do not leave the node in maintenance mode any more than necessary. </note>You can transition a storage node to maintenance mode only if the node is healthy (has no blocking cluster faults) and the storage cluster is tolerant to a single node failure. After you enable maintenance mode for a healthy and tolerant node, the node is not immediately transitioned; it is monitored until the following conditions are true: <ul id="GUID-1F452834-4644-4B99-9139-61AC2F09FE46"><li>All volumes hosted on the node have failed over and the node is no longer hosting as the primary for any volume. </li><li>A temporary standby node is assigned for every volume being failed over. </li></ul>After these criteria are met, the node is transitioned to maintenance mode. If these criteria are not met within a five-minute period, the node will not enter maintenance mode.<p>When you disable maintenance mode for a storage node, the node is monitored until the following conditions are true:<ul id="GUID-3C251BC7-41B2-41EF-A7A6-33A4464CA5D2"><li>All data is fully replicated to the node.</li><li>All blocking cluster faults are resolved.</li><li>All temporary standby node assignments for the volumes hosted on the node have been inactivated.</li></ul>After these criteria are met, the node is transitioned out of maintenance mode. If these criteria are not met within one hour, the node will fail to transition out of maintenance mode.</p></section>
    <section id="GUID-ECE2DA29-08CF-4969-9225-6BE4374F10A0">
      <title id="GUID-4B56405A-8218-478C-928B-5C4FB35D67BF">Possible scenarios while using maintenance mode</title>
      <ul id="GUID-57D0E33B-3CD1-44A3-88CD-829C8E8B114A">
        <li>If a node is in maintenance mode, but has not been rebooted yet, and/or has not had maintenance occur, or it had maintenance occur and is back up and healthy, but you have not disabled maintenance mode, and another node goes down, maintenance mode on the first node will be disabled automatically.</li>
        <li>If one of your nodes is in maintenance mode, and another node goes down at the same time, there will be an outage. You have to wait till the node that is in maintenance mode comes back online.</li>
        <li>If you put a node that is a member of an ensemble in maintenance mode for a long period of time, the system will automatically remove it from the ensemble, if there are other nodes available to be added in its place.</li>
      </ul>
    </section>
    <section id="GUID-94AFFD3C-5177-455A-BF4E-F22D00451AC1">
      <title id="GUID-F5189F57-91E1-4FB8-AA19-EFA00CB6A62C">Enable maintenance mode</title>
      <p>You can enable maintenance mode using the <apiname>EnableMaintenanceMode</apiname> API method. This method has the following input parameters: <table id="TABLE_8CFB1A7A8CAB40789B59BEAEC1A46AB2"><tgroup cols="5"><colspec colnum="1" colname="col1" colwidth="1.75*" /><colspec colnum="2" colname="col2" colwidth="1.40*" /><colspec colnum="3" colname="col3" colwidth="1.00*" /><colspec colnum="4" colname="col4" colwidth="1.27*" /><colspec colname="col5" colnum="5" colwidth="1.16*" /><thead><row><entry colname="col1">Name</entry><entry colname="col2">Description</entry><entry colname="col3">Type</entry><entry colname="col4">Default value </entry><entry colname="col5">Required </entry></row></thead><tbody><row><entry colname="col1"><parmname>forceWithUnresolvedFaults</parmname></entry><entry colname="col2">Force maintenance mode to be enabled for this node even with blocking cluster faults present.</entry><entry colname="col3">boolean</entry><entry colname="col4">False</entry><entry colname="col5">No</entry></row><row><entry colname="col1"><parmname>nodes</parmname></entry><entry colname="col2">The list of node IDs to put in maintenance mode. Only one node at a time is supported. </entry><entry colname="col3">integer array</entry><entry colname="col4">None</entry><entry colname="col5">Yes</entry></row><row><entry colname="col1"><parmname>perMinutePrimarySwapLimit</parmname></entry><entry colname="col2">The number of primary slices to swap per minute. If not specified, all primary slices will be swapped at once.</entry><entry colname="col3">integer</entry><entry colname="col4">None</entry><entry colname="col5">No</entry></row><row><entry colname="col1"><parmname>timeout</parmname></entry><entry colname="col2">Specifies how long maintenance mode should remain enabled before it is automatically disabled. Formatted as a time string (for example, HH:mm:ss). If not specified, maintenance mode will remain enabled until explicitly disabled.</entry><entry colname="col3">string</entry><entry colname="col4">None</entry><entry colname="col5">No</entry></row></tbody></tgroup></table>This method has the following return values: <table id="TABLE_B967117CB10C4B22A7CE525A65D5C9E3"><tgroup cols="3"><colspec colnum="1" colname="col1" colwidth="1*" /><colspec colnum="2" colname="col2" colwidth="2.04*" /><colspec colnum="3" colname="col3" colwidth="1.16*" /><thead><row><entry colname="col1">Name</entry><entry colname="col2">Description</entry><entry colname="col3">Type</entry></row></thead><tbody><row><entry colname="col1">asyncHandle</entry><entry colname="col2">You can use the <apiname>GetAsyncResult</apiname> method to retrieve this asyncHandle and determine when the maintenance mode transition is complete.</entry><entry colname="col3"> integer</entry></row><row><entry colname="col1">currentMode</entry><entry colname="col2">The current maintenance mode state of the node. Possible values:<ul id="GUID-0075BAD9-BC41-433A-8D59-F297730C737E"><li><option>Disabled</option>: No maintenance has been requested.</li><li><option>FailedToRecover</option>: The node failed to recover from maintenance mode.</li><li><option>RecoveringFromMaintenance</option>: The node is in the process of recovering from maintenance mode.</li><li><option>PreparingForMaintenance</option>: Actions are being taken to prepare a node to have maintenance performed.</li><li><option>ReadyForMaintenance</option>: The node is ready for maintenance to be performed.</li></ul></entry><entry colname="col3">MaintenanceMode (string)</entry></row><row><entry colname="col1">requestedMode</entry><entry colname="col2">The requested maintenance mode state of the node. Possible values:<ul id="GUID-819D1D88-5F9F-4FCB-B3B0-03E050E24973"><li><option>Disabled</option>: No maintenance has been requested.</li><li><option>FailedToRecover</option>: The node failed to recover from maintenance mode.</li><li><option>RecoveringFromMaintenance</option>: The node is in the process of recovering from maintenance mode.</li><li><option>PreparingForMaintenance</option>: Actions are being taken to prepare a node to have maintenance performed.</li><li><option>ReadyForMaintenance</option>: The node is ready for maintenance to be performed.</li></ul></entry><entry colname="col3">MaintenanceMode (string)</entry></row></tbody></tgroup></table>See the <xref href="https://docs.netapp.com/sfe-122/topic/com.netapp.doc.sfe-api/GUID-9A224B03-75F9-4288-8F2A-3E2BAD5918B0.html" format="html" scope="external">Element 12.2 API Reference Guide</xref> for more information.</p>
    </section>
    <section id="GUID-8ECA261E-006C-45C6-8D3A-C051C70CCB61">
      <title id="GUID-03262D76-0E5A-4142-810B-41CFA9E0996C">Disable maintenance mode</title>
      <p>You can disable maintenance mode using the <apiname>DisableMaintenanceMode</apiname> API method. This method has the following input parameter: <table id="TABLE_8CFB1A7A8CAB40789B59BEAEC1A46AB2"><tgroup cols="5"><colspec colnum="1" colname="col1" colwidth="1.75*" /><colspec colnum="2" colname="col2" colwidth="1.40*" /><colspec colnum="3" colname="col3" colwidth="1.00*" /><colspec colnum="4" colname="col4" colwidth="1.27*" /><colspec colname="col5" colnum="5" colwidth="1.16*" /><thead><row><entry colname="col1">Name</entry><entry colname="col2">Description</entry><entry colname="col3">Type</entry><entry colname="col4">Default value </entry><entry colname="col5">Required </entry></row></thead><tbody><row><entry colname="col1"><parmname>nodes</parmname></entry><entry colname="col2">List of storage node IDs to take out of maintenance mode.</entry><entry colname="col3">integer array</entry><entry colname="col4">None</entry><entry colname="col5">Yes</entry></row></tbody></tgroup></table>This method has the following return values: <table id="TABLE_B967117CB10C4B22A7CE525A65D5C9E3"><tgroup cols="3"><colspec colnum="1" colname="col1" colwidth="1*" /><colspec colnum="2" colname="col2" colwidth="2.35*" /><colspec colnum="3" colname="col3" colwidth="1.28*" /><thead><row><entry colname="col1">Name</entry><entry colname="col2">Description</entry><entry colname="col3">Type</entry></row></thead><tbody><row><entry colname="col1">asyncHandle</entry><entry colname="col2">You can use the <apiname>GetAsyncResult</apiname> method to retrieve this asyncHandle and determine when the maintenance mode transition is complete.</entry><entry colname="col3"> integer</entry></row><row><entry colname="col1">currentMode</entry><entry colname="col2">The current maintenance mode state of the node. Possible values:<ul id="GUID-630FB88B-42A2-4688-B1F9-1F7769EDC21B"><li><option>Disabled</option>: No maintenance has been requested.</li><li><option>FailedToRecover</option>: The node failed to recover from maintenance mode.</li><li><option>Unexpected</option>: The node was found to be offline, but was in the <option>Disabled</option> mode.</li><li><option>RecoveringFromMaintenance</option>: The node is in the process of recovering from maintenance mode.</li><li><option>PreparingForMaintenance</option>: Actions are being taken to prepare a node to have maintenance performed.</li><li><option>ReadyForMaintenance</option>: The node is ready for maintenance to be performed.</li></ul></entry><entry colname="col3">MaintenanceMode (string)</entry></row><row><entry colname="col1">requestedMode</entry><entry colname="col2">The requested maintenance mode state of the node. Possible values:<ul id="GUID-B734C269-1462-48C5-9250-42F0B4412125"><li><option>Disabled</option>: No maintenance has been requested.</li><li><option>FailedToRecover</option>: The node failed to recover from maintenance mode.</li><li><option>Unexpected</option>: The node was found to be offline, but was in the <option>Disabled</option> mode.</li><li><option>RecoveringFromMaintenance</option>: The node is in the process of recovering from maintenance mode.</li><li><option>PreparingForMaintenance</option>: Actions are being taken to prepare a node to have maintenance performed.</li><li><option>ReadyForMaintenance</option>: The node is ready for maintenance to be performed.</li></ul></entry><entry colname="col3">MaintenanceMode (string)</entry></row></tbody></tgroup></table>See the <xref href="https://docs.netapp.com/sfe-122/topic/com.netapp.doc.sfe-api/GUID-8F87E5ED-FB68-42BD-B6CD-56D6FF8B4F37.html" format="html" scope="external">Element 12.2 API Reference Guide</xref> for more information.</p>
    </section>
  </refbody>
</reference>